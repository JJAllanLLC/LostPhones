<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KQTTP3KMKN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-KQTTP3KMKN');
  </script>
  <!-- Microsoft Clarity -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "uivo0q97p5");
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thank You — Generating Your IMEI Report | LostPhones.com</title>
  <meta name="description" content="Your full IMEI report is being generated. Please wait while we process your verification request.">
  
  <!-- Open Graph / Social -->
  <meta property="og:title" content="Thank You — Generating Your IMEI Report">
  <meta property="og:description" content="Your full IMEI report is being generated. Please wait while we process your verification request.">
  <meta property="og:image" content="https://lostphones.com/assets/cover.jpg">
  <meta property="og:url" content="https://lostphones.com/imei-success.html">
  <meta property="og:type" content="website">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Thank You — Generating Your IMEI Report">
  <meta name="twitter:description" content="Your full IMEI report is being generated. Please wait while we process your verification request.">
  <meta name="twitter:image" content="https://lostphones.com/assets/cover.jpg">
  <link rel="canonical" href="https://lostphones.com/imei-success.html">
  <link rel="stylesheet" href="style.css">
  <style>
    .imei-success-section {
      padding: 8rem 2rem 4rem;
      min-height: calc(100vh - 120px);
      background: #f8f9fa;
    }
    
    .imei-success-container {
      max-width: 700px;
      margin: 0 auto;
      background: white;
      padding: 3rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      border: 1px solid #e0e0e0;
    }
    
    .imei-success-hero {
      text-align: center;
      margin-bottom: 2.5rem;
    }
    
    .imei-success-hero h1 {
      font-size: 2.5rem;
      color: #333;
      margin-bottom: 1rem;
      line-height: 1.3;
    }
    
    .imei-success-hero p {
      font-size: 1.25rem;
      color: #666;
      line-height: 1.7;
      margin-bottom: 2rem;
    }
    
    .loading-state {
      display: block;
    }
    
    .loading-state.hidden {
      display: none;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #e3f2fd;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .results-state {
      display: none;
    }
    
    .results-state.show {
      display: block;
    }
    
    .results-summary {
      text-align: center;
      padding: 2rem;
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 8px;
      margin-bottom: 2rem;
    }
    
    .results-summary h2 {
      font-size: 1.8rem;
      color: #1e40af;
      margin-bottom: 1rem;
    }
    
    .results-summary p {
      font-size: 1.2rem;
      color: #1e3a8a;
      line-height: 1.7;
      margin: 0;
    }
    
    .results-summary.clean {
      background: #f0fdf4;
      border-color: #86efac;
    }
    
    .results-summary.clean h2 {
      color: #166534;
    }
    
    .results-summary.clean p {
      color: #15803d;
    }
    
    .results-summary.issue {
      background: #fef2f2;
      border-color: #fecaca;
    }
    
    .results-summary.issue h2 {
      color: #991b1b;
    }
    
    .results-summary.issue p {
      color: #dc2626;
    }
    
    .result-cards {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    @media (min-width: 768px) {
      .result-cards {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .result-card {
      padding: 2rem;
      border-radius: 8px;
      border: 2px solid;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .result-card.clean {
      background: #f0fdf4;
      border-color: #22c55e;
    }
    
    .result-card.issue {
      background: #fef2f2;
      border-color: #ef4444;
    }
    
    .result-card h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #333;
    }
    
    .result-card.clean h3 {
      color: #166534;
    }
    
    .result-card.issue h3 {
      color: #991b1b;
    }
    
    .result-card-status {
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    
    .result-card.clean .result-card-status {
      color: #15803d;
    }
    
    .result-card.issue .result-card-status {
      color: #dc2626;
    }
    
    .result-card-details {
      font-size: 1.1rem;
      color: #666;
      line-height: 1.6;
      margin-top: 1rem;
    }
    
    .result-card.clean .result-card-details {
      color: #166534;
    }
    
    .result-card.issue .result-card-details {
      color: #991b1b;
    }
    
    .full-report-dropdown {
      margin: 2rem 0;
      display: none;
    }
    
    .results-state.show .full-report-dropdown {
      display: block;
    }
    
    .full-report-toggle {
      text-align: center;
      padding: 0.75rem 0;
      cursor: pointer;
      user-select: none;
      color: #666;
      font-size: 0.95rem;
      transition: color 0.2s ease;
    }
    
    .full-report-toggle:hover {
      color: #333;
    }
    
    .full-report-toggle::after {
      content: ' ▼';
      font-size: 0.8rem;
      display: inline-block;
      transition: transform 0.3s ease;
    }
    
    .full-report-toggle.expanded::after {
      transform: rotate(180deg);
    }
    
    @media (min-width: 768px) {
      .full-report-toggle {
        text-align: right;
      }
    }
    
    .full-report-content {
      display: none;
      margin-top: 1rem;
      padding: 1.5rem;
      background: #f5f5f5;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    
    .full-report-content.show {
      display: block;
    }
    
    .full-report-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .full-report-list li {
      padding: 0.5rem 0;
      border-bottom: 1px solid #e0e0e0;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    .full-report-list li:last-child {
      border-bottom: none;
    }
    
    .full-report-list li strong {
      color: #333;
      font-weight: 600;
      display: inline-block;
      min-width: 140px;
    }
    
    .full-report-list li span {
      color: #555;
    }
    
    .next-steps {
      text-align: center;
      padding: 2rem;
      margin-top: 2rem;
    }
    
    .next-steps a {
      color: #3b82f6;
      text-decoration: none;
      font-size: 1.2rem;
      font-weight: 600;
      transition: color 0.3s ease;
    }
    
    .next-steps a:hover {
      color: #2563eb;
      text-decoration: underline;
    }
    
    .error-state {
      display: none;
      text-align: center;
      padding: 2rem;
      background: #fef2f2;
      border: 2px solid #ef4444;
      border-radius: 8px;
      margin-top: 2rem;
    }
    
    .error-state.show {
      display: block;
    }
    
    .error-state h2 {
      color: #991b1b;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    
    .error-state p {
      color: #dc2626;
      font-size: 1.1rem;
      line-height: 1.7;
      margin-bottom: 1rem;
    }
    
    @media (max-width: 768px) {
      .imei-success-section {
        padding: 6rem 1.5rem 3rem;
      }
      
      .imei-success-container {
        padding: 2rem 1.5rem;
      }
      
      .imei-success-hero h1 {
        font-size: 2rem;
      }
      
      .imei-success-hero p {
        font-size: 1.1rem;
      }
      
      .results-summary h2 {
        font-size: 1.5rem;
      }
      
      .results-summary p {
        font-size: 1.1rem;
      }
    }
    
    @media (max-width: 480px) {
      .imei-success-container {
        padding: 1.5rem 1rem;
      }
      
      .imei-success-hero h1 {
        font-size: 1.75rem;
      }
      
      .result-card {
        padding: 1.5rem;
      }
      
      .result-card h3 {
        font-size: 1.3rem;
      }
      
      .result-card-status {
        font-size: 1.1rem;
      }
      
      .full-report-toggle {
        font-size: 0.9rem;
      }
      
      .full-report-content {
        padding: 1rem;
      }
      
      .full-report-list li {
        font-size: 0.9rem;
        padding: 0.4rem 0;
      }
      
      .full-report-list li strong {
        min-width: 100px;
        font-size: 0.85rem;
      }
    }
  </style>
</head>
<body>

  <header class="blog-header">
    <h1>LostPhones.com</h1>
    <nav>
      <ul>
        <li><a href="index.html#home">Home</a></li>
        <li><a href="index.html#start">Start</a></li>
        <li><a href="index.html#guide">Guide</a></li>
        <li><a href="blog/index.html">Blog</a></li>
        <li><a href="imei-check.html">IMEI Check</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </nav>
  </header>

  <div class="main-content">
    <section class="imei-success-section">
      <div class="imei-success-container">
        
        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
          <div class="imei-success-hero">
            <h1>Thank you — generating your full IMEI report</h1>
            <p>This takes 20-60 seconds. Please do not close this page.</p>
          </div>
          
          <div class="spinner"></div>
          
          <p style="text-align: center; margin-top: 2rem; color: #666; font-size: 1rem;">
            While you wait, <a href="/" style="color: #3b82f6; text-decoration: underline;">review our free recovery checklist →</a>
          </p>
        </div>
        
        <!-- Results State -->
        <div class="results-state" id="resultsState">
          <div class="results-summary" id="resultsSummary">
            <h2>Report Complete</h2>
            <p id="summaryText">Loading your report...</p>
          </div>
          
          <div class="result-cards">
            <div class="result-card" id="appleCard">
              <h3>Apple Lost/Found My iPhone Status</h3>
              <div class="result-card-status" id="appleStatus">Checking...</div>
              <div class="result-card-details" id="appleDetails"></div>
            </div>
            
            <div class="result-card" id="gsmaCard">
              <h3>GSMA Blacklist Status</h3>
              <div class="result-card-status" id="gsmaStatus">Checking...</div>
              <div class="result-card-details" id="gsmaDetails"></div>
            </div>
          </div>
          
          <!-- Full Report Details Dropdown -->
          <div class="full-report-dropdown">
            <div class="full-report-toggle" id="fullReportToggle">View Full Report Details</div>
            <div class="full-report-content" id="fullReportContent">
              <ul class="full-report-list" id="fullReportList">
                <!-- Details will be populated by JavaScript -->
              </ul>
            </div>
          </div>
          
          <div class="next-steps">
            <a href="/">Return to our free recovery checklist →</a>
          </div>
        </div>
        
        <!-- Error State -->
        <div class="error-state" id="errorState">
          <h2>Unable to Generate Report</h2>
          <p id="errorMessage">We encountered an issue while generating your report. Please try again or contact support if the problem persists.</p>
          <p style="margin-top: 1rem;">
            <a href="/" style="color: #3b82f6; text-decoration: underline;">Return to our free recovery checklist →</a>
          </p>
        </div>
        
      </div>
    </section>
  </div>

  <footer style="background:#e9ecef; padding:60px 20px; text-align:center; border-top:5px solid #007bff; margin-top:120px; font-family:Arial, sans-serif;">
    <div style="max-width:1200px; margin:0 auto;">
      <div style="margin-bottom:20px;">
        <a href="index.html" style="margin:0 15px; color:#333; text-decoration:none;">Home</a>
        <a href="index.html#start" style="margin:0 15px; color:#333; text-decoration:none;">Start</a>
        <a href="index.html#guide" style="margin:0 15px; color:#333; text-decoration:none;">Guide</a>
        <a href="blog/index.html" style="margin:0 15px; color:#333; text-decoration:none;">Blog</a>
        <a href="imei-check.html" style="margin:0 15px; color:#333; text-decoration:none;">IMEI Check</a>
        <a href="about.html" style="margin:0 15px; color:#333; text-decoration:none;">About</a>
      </div>
      <div style="margin-bottom:20px;">
        <a href="privacy.html" style="margin:0 15px; color:#333; text-decoration:none;">Privacy Policy</a>
        <a href="terms.html" style="margin:0 15px; color:#333; text-decoration:none;">Terms of Service</a>
      </div>
      <div style="color:#555; font-size:0.9rem; margin-top:20px;">Questions? Email <a href="mailto:lostphones.help@gmail.com" style="color:#007bff; text-decoration:none;">lostphones.help@gmail.com</a></div>
      <div style="color:#555; font-size:0.9rem; margin-top:30px;">© 2025 LostPhones.com</div>
    </div>
  </footer>

  <script>
    // Get session_id from URL query parameter
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('session_id');
    
    // DOM elements
    const loadingState = document.getElementById('loadingState');
    const resultsState = document.getElementById('resultsState');
    const errorState = document.getElementById('errorState');
    const resultsSummary = document.getElementById('resultsSummary');
    const summaryText = document.getElementById('summaryText');
    const appleCard = document.getElementById('appleCard');
    const appleStatus = document.getElementById('appleStatus');
    const appleDetails = document.getElementById('appleDetails');
    const gsmaCard = document.getElementById('gsmaCard');
    const gsmaStatus = document.getElementById('gsmaStatus');
    const gsmaDetails = document.getElementById('gsmaDetails');
    const errorMessage = document.getElementById('errorMessage');
    const fullReportToggle = document.getElementById('fullReportToggle');
    const fullReportContent = document.getElementById('fullReportContent');
    const fullReportList = document.getElementById('fullReportList');
    
    // Fetch IMEI report
    async function fetchIMEIReport() {
      if (!sessionId) {
        showError('Session ID not found. Please return to the checkout page and try again.');
        return;
      }
      
      try {
        const response = await fetch(`/api/fetch-imei-report?session_id=${encodeURIComponent(sessionId)}`);
        
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
          throw new Error(errorData.error || `Server error: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (!data.success) {
          throw new Error(data.error || 'Failed to generate report');
        }
        
        // Display results
        displayResults(data);
        
      } catch (error) {
        console.error('Error fetching IMEI report:', error);
        showError(error.message || 'We encountered an issue while generating your report. Please try again or contact support if the problem persists.');
      }
    }
    
    // Display results
    function displayResults(data) {
      // Hide loading state, show results
      loadingState.classList.add('hidden');
      resultsState.classList.add('show');
      
      // Update summary
      summaryText.textContent = data.summary || 'Your report is ready.';
      
      // Determine if overall clean or has issues
      const isClean = data.overallClean;
      if (isClean) {
        resultsSummary.classList.add('clean');
        resultsSummary.classList.remove('issue');
      } else {
        resultsSummary.classList.add('issue');
        resultsSummary.classList.remove('clean');
      }
      
      // Update Apple card
      const appleClean = data.apple?.clean && !data.apple?.error;
      const appleHasLost = data.apple?.icloudLost === true;
      
      if (data.apple?.error) {
        appleCard.classList.remove('clean', 'issue');
        appleStatus.textContent = 'Error';
        appleDetails.textContent = 'Unable to retrieve Apple status. Please try again later.';
      } else if (appleHasLost) {
        appleCard.classList.add('issue');
        appleCard.classList.remove('clean');
        appleStatus.textContent = '⚠️ Reported Lost';
        appleDetails.textContent = 'This device has been reported lost or stolen via iCloud Lost Mode.';
      } else {
        appleCard.classList.add('clean');
        appleCard.classList.remove('issue');
        const fmiStatus = data.apple?.fmi || 'Unknown';
        appleStatus.textContent = fmiStatus === 'ON' ? '✓ Find My Enabled' : '✓ No Issues Detected';
        appleDetails.textContent = fmiStatus === 'ON' 
          ? 'Find My iPhone is enabled. No lost mode detected.'
          : 'No lost or stolen reports found for this device.';
      }
      
      // Update GSMA card
      const gsmaClean = data.gsma?.clean && !data.gsma?.error;
      const gsmaBlacklisted = data.gsma?.blacklisted === true;
      
      if (data.gsma?.error) {
        gsmaCard.classList.remove('clean', 'issue');
        gsmaStatus.textContent = 'Error';
        gsmaDetails.textContent = 'Unable to retrieve blacklist status. Please try again later.';
      } else if (gsmaBlacklisted) {
        gsmaCard.classList.add('issue');
        gsmaCard.classList.remove('clean');
        gsmaStatus.textContent = '⚠️ Blacklisted';
        gsmaDetails.textContent = 'This device has been reported to the GSMA blacklist database.';
      } else {
        gsmaCard.classList.add('clean');
        gsmaCard.classList.remove('issue');
        gsmaStatus.textContent = '✓ Clean';
        gsmaDetails.textContent = 'This device is not blacklisted and can be activated on any carrier.';
      }
      
      // Populate full report details dropdown
      populateFullReportDetails(data);
    }
    
    // Populate full report details dropdown
    function populateFullReportDetails(data) {
      // Clear existing list
      fullReportList.innerHTML = '';
      
      // Get details from apple.details
      const details = data.apple?.details || {};
      
      // Field mapping: API key -> Display name
      const fieldMap = {
        'model': 'Model',
        'device_model': 'Model',
        'serial': 'Serial Number',
        'serial_number': 'Serial Number',
        'warranty': 'Warranty Status',
        'warranty_status': 'Warranty Status',
        'carrier': 'Carrier',
        'carrier_name': 'Carrier',
        'simlock': 'SIM Lock Status',
        'sim_lock': 'SIM Lock Status',
        'imei': 'IMEI',
        'storage': 'Storage',
        'capacity': 'Storage',
        'color': 'Color',
        'purchase_date': 'Estimated Purchase Date',
        'activation_country': 'Last Activation Country',
        'replaced': 'Replaced Device',
        'network': 'Network',
        'device_type': 'Device Type',
        'brand': 'Brand',
        'manufacturer': 'Manufacturer'
      };
      
      // Add IMEI if available from root level
      if (data.imei) {
        const li = document.createElement('li');
        li.innerHTML = '<strong>IMEI:</strong> <span>' + escapeHtml(data.imei) + '</span>';
        fullReportList.appendChild(li);
      }
      
      // Add all available detail fields
      const addedFields = new Set();
      Object.keys(details).forEach(key => {
        const value = details[key];
        if (value !== undefined && value !== null && value !== '' && !addedFields.has(key.toLowerCase())) {
          const displayName = fieldMap[key.toLowerCase()] || formatFieldName(key);
          const li = document.createElement('li');
          li.innerHTML = '<strong>' + escapeHtml(displayName) + ':</strong> <span>' + escapeHtml(String(value)) + '</span>';
          fullReportList.appendChild(li);
          addedFields.add(key.toLowerCase());
        }
      });
      
      // If no details available, show message
      if (fullReportList.children.length === 0) {
        const li = document.createElement('li');
        li.innerHTML = '<span style="color: #999; font-style: italic;">No additional details available for this device.</span>';
        fullReportList.appendChild(li);
      }
    }
    
    // Format field name for display (convert snake_case or camelCase to Title Case)
    function formatFieldName(key) {
      return key
        .replace(/_/g, ' ')
        .replace(/([A-Z])/g, ' $1')
        .toLowerCase()
        .replace(/^\w/, c => c.toUpperCase())
        .trim();
    }
    
    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // Toggle dropdown
    if (fullReportToggle) {
      fullReportToggle.addEventListener('click', function() {
        fullReportToggle.classList.toggle('expanded');
        fullReportContent.classList.toggle('show');
      });
    }
    
    // Show error state
    function showError(message) {
      loadingState.classList.add('hidden');
      resultsState.classList.remove('show');
      errorState.classList.add('show');
      errorMessage.textContent = message;
    }
    
    // Fetch report on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fetchIMEIReport);
    } else {
      fetchIMEIReport();
    }
  </script>
</body>
</html>
